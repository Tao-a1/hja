    <!-- åˆ—è¡¨ç»“æŸ -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // --- é…ç½® ---
            const dict = {
                "Name": "æ–‡ä»¶å",
                "Last modified": "ä¿®æ”¹æ—¶é—´",
                "Size": "å¤§å°",
                "Description": "æè¿°",
                "Parent Directory": "â¬†ï¸ è¿”å›ä¸Šçº§ç›®å½•"
            };

            const table = document.querySelector("table");
            if (!table) return;

            // --- 0. æ’å…¥æ‰¹é‡æ“ä½œå·¥å…·æ  ---
            const toolbar = document.createElement("div");
            toolbar.style.cssText = "margin-bottom: 10px; display: none;"; // é»˜è®¤éšè—ï¼Œæœ‰é€‰ä¸­æ—¶æ˜¾ç¤ºæˆ–å§‹ç»ˆæ˜¾ç¤º
            toolbar.innerHTML = `
                <button id="batchDeleteBtn" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤é€‰ä¸­é¡¹
                </button>
                <span id="selectCount" style="margin-left: 10px; color: #666; font-size: 14px;"></span>
            `;
            table.parentNode.insertBefore(toolbar, table);

            // --- 1. æ”¹é€ è¡¨æ ¼ç»“æ„ (æ·»åŠ  Checkbox åˆ—å’Œæ“ä½œåˆ—) ---
            
            // 1.1 è¡¨å¤´
            const theadRow = table.querySelector("thead tr") || table.querySelector("tr");
            let dateColIndex = -1;
            
            if (theadRow) {
                // æ’å…¥ Checkbox è¡¨å¤´
                const thCheck = document.createElement("th");
                thCheck.style.width = "30px";
                thCheck.innerHTML = '<input type="checkbox" id="selectAll">';
                theadRow.insertBefore(thCheck, theadRow.firstChild);

                // æ’å…¥â€œæ“ä½œâ€è¡¨å¤´
                const thAction = document.createElement("th");
                thAction.innerText = "æ“ä½œ";
                thAction.style.width = "140px";
                theadRow.appendChild(thAction);

                // æ±‰åŒ–è¡¨å¤´å¹¶æŸ¥æ‰¾æ—¥æœŸåˆ—
                Array.from(theadRow.children).forEach((th, index) => {
                    // æŸ¥æ‰¾é“¾æ¥æˆ–ç›´æ¥æ–‡æœ¬
                    const link = th.querySelector('a');
                    const textNode = link ? link : th;
                    const text = textNode.innerText.trim();

                    if (dict[text]) textNode.innerText = dict[text];
                    
                    if (text === "Last modified" || text === "ä¿®æ”¹æ—¶é—´") {
                        dateColIndex = index;
                    }
                });
            }

            // 1.2 è¡¨æ ¼å†…å®¹
            const rows = table.querySelectorAll("tbody tr");
            rows.forEach(function(row) {
                const link = row.querySelector("a");
                if (!link) return;

                const fileName = link.getAttribute("href");
                const linkText = link.innerText.trim();
                const isParentDir = linkText.includes("Parent Directory") || fileName.startsWith("../");

                // A. æ’å…¥ Checkbox åˆ—
                const tdCheck = document.createElement("td");
                if (!isParentDir) {
                    tdCheck.innerHTML = `<input type="checkbox" class="file-check" value="${fileName}">`;
                }
                row.insertBefore(tdCheck, row.firstChild);

                // B. æ ¼å¼åŒ–æ—¥æœŸ
                const cells = row.querySelectorAll("td");
                // æ³¨æ„ï¼šæ’å…¥ Checkbox åï¼ŒåŸæ¥çš„ index å¯èƒ½ä¼šé”™ä½ï¼Œæ‰€ä»¥é‡æ–°è·å– cells
                // dateColIndex æ˜¯åŸºäºåŸå§‹è¡¨å¤´çš„ï¼Œç°åœ¨å¤šäº†ä¸€åˆ—ï¼Œæ‰€ä»¥ +1 ? 
                // ä¸ï¼Œtheadä¹ŸåŠ äº†ä¸€åˆ—ï¼Œæ‰€ä»¥ dateColIndex æŒ‡å‘çš„åº”è¯¥æ˜¯æ—§çš„åˆ—ï¼Œ
                // ä½†æ˜¯ DOM é›†åˆæ˜¯å®æ—¶çš„ã€‚å¦‚æœ dateColIndex æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ–° cells é›†åˆä¸­ï¼Œè¯¥åˆ—ç´¢å¼•åº”è¯¥æ˜¯ dateColIndex (å› ä¸ºæ˜¯åœ¨å‰é¢æ’å…¥çš„?)
                // ç­‰ç­‰ï¼ŒArray.from(theadRow.children) æ˜¯åœ¨æ’å…¥åæ‰§è¡Œçš„å—ï¼Ÿ
                // ä¸Šé¢çš„ä»£ç æ˜¯ï¼šæ’å…¥ thCheck -> è®¡ç®— dateColIndexã€‚æ‰€ä»¥ dateColIndex å·²ç»æ˜¯åŒ…å« Checkbox åˆ—åçš„æ­£ç¡®ç´¢å¼•äº†ã€‚
                
                if (dateColIndex >= 0 && cells[dateColIndex]) {
                     const dateCell = cells[dateColIndex];
                     const originalDate = dateCell.innerText.trim();
                     const dateObj = new Date(originalDate);
                     if (!isNaN(dateObj) && originalDate.length > 5) { // ç®€å•è¿‡æ»¤
                        // æ ¼å¼åŒ–é€»è¾‘...
                        const format = (n) => n.toString().padStart(2, '0');
                        dateCell.innerText = `${dateObj.getFullYear()}-${format(dateObj.getMonth()+1)}-${format(dateObj.getDate())} ${format(dateObj.getHours())}:${format(dateObj.getMinutes())}`;
                        dateCell.style.fontFamily = "monospace";
                     }
                }

                // C. æ’å…¥â€œæ“ä½œâ€åˆ—
                const tdAction = document.createElement("td");
                if (!isParentDir) {
                    // ä¸‹è½½
                    const dlBtn = document.createElement("a");
                    dlBtn.href = fileName;
                    dlBtn.setAttribute("download", "");
                    dlBtn.innerHTML = "â¬‡ï¸";
                    dlBtn.title = "ä¸‹è½½";
                    dlBtn.style.cssText = "margin-right: 10px; text-decoration: none; font-size: 16px;";
                    tdAction.appendChild(dlBtn);

                    // åˆ é™¤
                    const delBtn = document.createElement("span");
                    delBtn.innerHTML = "ğŸ—‘ï¸";
                    delBtn.title = "åˆ é™¤";
                    delBtn.style.cssText = "cursor: pointer; font-size: 16px;";
                    delBtn.onclick = function() { deleteFile(fileName, row); };
                    tdAction.appendChild(delBtn);
                } else {
                    // æ±‰åŒ– Parent Directory
                    link.innerText = "â¬†ï¸ è¿”å›ä¸Šçº§ç›®å½•";
                }
                row.appendChild(tdAction);
            });


            // --- 2. äº‹ä»¶å¤„ç† ---

            // å…¨é€‰/åé€‰
            const selectAll = document.getElementById('selectAll');
            const fileChecks = document.querySelectorAll('.file-check');
            
            if (selectAll) {
                selectAll.addEventListener('change', function() {
                    fileChecks.forEach(cb => cb.checked = this.checked);
                    updateToolbar();
                });
            }

            // å•ä¸ªå‹¾é€‰ç›‘å¬
            fileChecks.forEach(cb => {
                cb.addEventListener('change', updateToolbar);
            });

            // æ›´æ–°å·¥å…·æ çŠ¶æ€
            function updateToolbar() {
                const checked = document.querySelectorAll('.file-check:checked');
                const count = checked.length;
                if (count > 0) {
                    toolbar.style.display = 'block';
                    document.getElementById('selectCount').innerText = `å·²é€‰æ‹© ${count} ä¸ªé¡¹ç›®`;
                } else {
                    toolbar.style.display = 'none';
                }
            }

            // æ‰¹é‡åˆ é™¤
            document.getElementById('batchDeleteBtn').onclick = async function() {
                const checked = document.querySelectorAll('.file-check:checked');
                if (checked.length === 0) return;

                if (!confirm(`âš ï¸ ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checked.length} ä¸ªæ–‡ä»¶å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;

                let successCount = 0;
                let failCount = 0;

                // å¹¶è¡Œåˆ é™¤ (é™åˆ¶å¹¶å‘å¯èƒ½æ›´å¥½ï¼Œä½†è¿™é‡Œç®€åŒ–ä¸º Promise.all)
                const promises = Array.from(checked).map(cb => {
                    const url = cb.value;
                    return fetch(url, { method: 'DELETE' })
                        .then(res => {
                            if (res.ok) {
                                successCount++;
                                // è§†è§‰ç§»é™¤
                                const row = cb.closest('tr');
                                row.style.opacity = 0;
                            } else {
                                failCount++;
                                console.error(`Delete failed for ${url}: ${res.status}`);
                            }
                        })
                        .catch(err => {
                            failCount++;
                            console.error(err);
                        });
                });

                await Promise.all(promises);

                // åˆ·æ–°é¡µé¢
                alert(`åˆ é™¤å®Œæˆã€‚\næˆåŠŸ: ${successCount}\nå¤±è´¥: ${failCount}`);
                window.location.reload();
            };
        });

        // å•ä¸ªåˆ é™¤å‡½æ•°
        function deleteFile(url, rowElement) {
            const decodedName = decodeURIComponent(url);
            if (!confirm("âš ï¸ ç¡®å®šè¦æ°¸ä¹…åˆ é™¤: " + decodedName + "?")) return;

            fetch(url, { method: 'DELETE' })
            .then(response => {
                if (response.ok) {
                    rowElement.style.background = "#ffebee";
                    rowElement.style.opacity = '0';
                    setTimeout(() => rowElement.remove(), 500);
                } else {
                    alert("âŒ åˆ é™¤å¤±è´¥");
                }
            });
        }
    </script>
    <footer style="margin-top: 3rem; color: #999; font-size: 12px; text-align: center; border-top: 1px solid #eee; padding-top: 1rem;">
        Gemini æ–‡ä»¶æœåŠ¡å™¨
    </footer>
</body>
</html>
